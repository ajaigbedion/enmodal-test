L.Curve=L.Path.extend({options:{},initialize:function(t,n){L.setOptions(this,n),this._setPath(t)},getPath:function(){return this._coords},setPath:function(t){return this._setPath(t),this.redraw()},getBounds:function(){return this._bounds},_setPath:function(t){this._coords=t,this._bounds=this._computeBounds()},_computeBounds:function(){for(var t,n,e,o=new L.LatLngBounds,i=0;i<this._coords.length;i++)if("string"==typeof(e=this._coords[i])||e instanceof String)n=e;else if("H"==n)o.extend([t.lat,e[0]]),t=new L.latLng(t.lat,e[0]);else if("V"==n)o.extend([e[0],t.lng]),t=new L.latLng(e[0],t.lng);else if("C"==n){var s=new L.latLng(e[0],e[1]);e=this._coords[++i];var r=new L.latLng(e[0],e[1]);e=this._coords[++i];var a=new L.latLng(e[0],e[1]);o.extend(s),o.extend(r),o.extend(a),a.controlPoint1=s,a.controlPoint2=r,t=a}else if("S"==n){r=new L.latLng(e[0],e[1]);e=this._coords[++i];a=new L.latLng(e[0],e[1]),s=t;if(t.controlPoint2){var f=t.lat-t.controlPoint2.lat,l=t.lng-t.controlPoint2.lng;s=new L.latLng(t.lat+f,t.lng+l)}o.extend(s),o.extend(r),o.extend(a),a.controlPoint1=s,a.controlPoint2=r,t=a}else if("Q"==n){var h=new L.latLng(e[0],e[1]);e=this._coords[++i];a=new L.latLng(e[0],e[1]);o.extend(h),o.extend(a),a.controlPoint=h,t=a}else if("T"==n){a=new L.latLng(e[0],e[1]),h=t;if(t.controlPoint){f=t.lat-t.controlPoint.lat,l=t.lng-t.controlPoint.lng;h=new L.latLng(t.lat+f,t.lng+l)}o.extend(h),o.extend(a),a.controlPoint=h,t=a}else o.extend(e),t=new L.latLng(e[0],e[1]);return o},getCenter:function(){return this._bounds.getCenter()},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updatecurve(this)},translatePoint:function(t,n,e){return L.point(t.x+n*Math.cos(e),t.y+n*Math.sin(e))},offsetPointLine:function(t,n){var e=t.length;if(e<2)throw new Error("Line should be defined by at least 2 points");for(var o,i,s,r=t[0],a=[],f=1;f<e;f++)o=t[f],i=(s=Math.atan2(r.y-o.y,r.x-o.x))-Math.PI/2,a.push({angle:s,offsetAngle:i,distance:n,original:[r,o],offset:[this.translatePoint(r,n,i),this.translatePoint(o,n,i)]}),r=o;return a},latLngsToPoints:function(t,n){for(var e=[],o=0,i=t.length;o<i;o++)e[o]=n.project(t[o]);return e},pointsToLatLngs:function(t,n){for(var e=[],o=0,i=t.length;o<i;o++)e[o]=n.unproject(t[o]);return e},offsetLatLngs:function(t,n,e){var o=this.offsetLatLngsToPoints(t,n,e);return this.pointsToLatLngs(o,e)},offsetLatLngsToPoints:function(t,n,e){var o=this.latLngsToPoints(t,e);return this.offsetPoints(o,n)},offsetPoints:function(t,n){var e=this.offsetPointLine(t,n);return this.joinLineSegments(e,n,"round")},intersection:function(t,n,e,o){var i=this.lineEquation(t,n),s=this.lineEquation(e,o);if(null==i||null==s)return null;if(i.hasOwnProperty("x"))return s.hasOwnProperty("x")?null:L.point(i.x,s.a*i.x+s.b);if(s.hasOwnProperty("x"))return L.point(s.x,i.a*s.x+i.b);if(i.a==s.a)return null;var r=(s.b-i.b)/(i.a-s.a),a=i.a*r+i.b;return L.point(r,a)},lineEquation:function(t,n){if(t.x!=n.x){var e=(n.y-t.y)/(n.x-t.x);return{a:e,b:t.y-e*t.x}}return t.y!=n.y?{x:t.x}:null},joinSegments:function(t,n,e,o){var i=[];switch(o){case"round":i=this.circularArc(t,n,e);break;case"cut":i=[this.intersection(t.offset[0],t.offset[1],n.original[0],n.original[1]),this.intersection(t.original[0],t.original[1],n.offset[0],n.offset[1])];break;case"straight":i=[t.offset[1],n.offset[0]];break;case"intersection":default:i=[this.intersection(t.offset[0],t.offset[1],n.offset[0],n.offset[1])]}return i.filter(function(t){return t})},joinLineSegments:function(t,n,e){var o=t.length,i=[],s=t[0],r=t[0];i.push(s.offset[0]);for(var a=1;a<o;a++)r=t[a],i=i.concat(this.joinSegments(s,r,n,e)),s=r;return i.push(r.offset[1]),i},circularArc:function(t,n,e){if(t.angle==n.angle)return[t.offset[1]];var o=t.original[1],i=[];if(e<0)var s=t.offsetAngle,r=n.offsetAngle;else s=n.offsetAngle,r=t.offsetAngle;if(r<s&&(r+=2*Math.PI),r>s+Math.PI)return[this.intersection(t.offset[0],t.offset[1],n.offset[0],n.offset[1])];for(var a=Math.abs(8/e),f=s;f<r;f+=a)i.push(this.translatePoint(o,e,f));return i.push(this.translatePoint(o,e,r)),e>0&&i.reverse(),i},_project:function(){var t,n,e,o;this._points=[];var i=this._coords[1],s=this._coords[this._coords.length-1],r=this._map.latLngToLayerPoint([i[0],i[1]]),a=this._map.latLngToLayerPoint([s[0],s[1]]),f=Math.atan2(a.x-r.x,a.y-r.y);f+=Math.PI/2;for(var l=Math.sin(f)*this.options.offset,h=Math.cos(f)*this.options.offset,u=0;u<this._coords.length;u++)if("string"==typeof(t=this._coords[u])||t instanceof String)this._points.push(t),e=t;else{switch(t.length){case 2:o=this._map.latLngToLayerPoint(t),n=t;break;case 1:"H"==e?(o=this._map.latLngToLayerPoint([n[0],t[0]]),n=[n[0],t[0]]):(o=this._map.latLngToLayerPoint([t[0],n[1]]),n=[t[0],n[1]])}this._points.push(L.point([o.x+l,o.y+h]))}}}),L.curve=function(t,n){return new L.Curve(t,n)},L.SVG.include({_updatecurve:function(t){this._setPath(t,this._curvePointsToPath(t._points))},_curvePointsToPath:function(t){for(var n,e,o="",i=0;i<t.length;i++)if("string"==typeof(n=t[i])||n instanceof String)o+=e=n;else switch(e){case"H":o+=n.x+" ";break;case"V":o+=n.y+" ";break;default:o+=n.x+","+n.y+" "}return o||"M0 0"}});